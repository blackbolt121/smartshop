<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Lista de Pedidos</title>
  <link rel="icon" type="image/x-icon" href="https://res.cloudinary.com/dv0hzntey/image/upload/v1754238574/urrea_g4nc5s.ico">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex min-h-screen bg-gray-50">
<!-- Sidebar de Navegación -->
<div class="w-64 bg-white border-r border-gray-200 shadow-lg">
  <div class="p-4 text-xl font-bold border-b">
    <a th:href="@{/admin/dashboard}">
      <!-- Asumiendo que tienes una imagen de logo, si no, puedes poner texto -->
      <img th:src="@{/images/logo.png}" alt="SmartShop" class="w-40"
           onerror="this.onerror=null; this.outerHTML='<span>SmartShop</span>'"/>
    </a>
  </div>
  <nav class="p-4 space-y-2">
    <a th:href="@{/admin/users}" class="block px-4 py-2 rounded hover:bg-gray-100 text-gray-700">Usuarios</a>
    <!-- Marca el enlace actual como activo -->
    <a th:href="@{/admin/orders}" class="block px-4 py-2 rounded bg-blue-50 text-blue-600 font-semibold">Pedidos</a>
    <a th:href="@{/admin/quotes}" class="block px-4 py-2 rounded hover:bg-gray-100 text-gray-700">Cotizaciones</a>
    <a th:href="@{/admin/products}" class="block px-4 py-2 rounded hover:bg-gray-100 text-gray-700">Productos</a>
    <a th:href="@{/admin/promotions}" class="block px-4 py-2 rounded hover:bg-gray-100 text-gray-700">Carousel</a>
    <a th:href="@{/admin/logout}" class="block px-4 py-2 rounded hover:bg-red-100 text-red-600">Cerrar sesión</a>
  </nav>
</div>

<!-- Contenido Principal -->
<div class="flex-1 p-8">
  <div class="bg-white p-6 rounded-lg shadow-md">
    <h1 class="text-2xl font-bold mb-6 text-gray-800">Lista de Pedidos</h1>
    <div class="overflow-x-auto">
      <table class="min-w-full border-collapse">
        <thead class="bg-gray-100">
        <tr>
          <!-- CAMBIO: Se han añadido y renombrado columnas para ser más descriptivas -->
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">ID Pedido</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Fecha</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Cliente</th>
          <th class="px-4 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider">Total</th>
          <th class="px-4 py-3 text-center text-xs font-medium text-gray-600 uppercase tracking-wider">Estado</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Guía</th>
          <th class="px-4 py-3 text-center text-xs font-medium text-gray-600 uppercase tracking-wider">Acciones</th>
        </tr>
        </thead>
        <!-- CAMBIO: La condición para mostrar la tabla es más simple y correcta -->
        <tbody class="bg-white divide-y divide-gray-200" th:if="${not #lists.isEmpty(orders)}">
        <tr th:each="order : ${orders}" class="hover:bg-gray-50">
          <!-- CAMBIO: Se muestran los campos de la entidad 'Pedidos' -->
          <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900" th:text="${order.id}">1</td>
          <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-700" th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">21/07/2025</td>
          <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-700" th:text="${order.usuario.email}">juan@example.com</td>
          <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-700 text-right">$<span th:text="${#numbers.formatDecimal(order.total, 0, 'COMMA', 2, 'POINT')}">0.00</span></td>
          <td class="px-4 py-4 whitespace-nowrap text-center">
            <!-- Se puede añadir estilo condicional basado en el estado -->
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                  th:text="${order.pedidoStatus.getStatus()}"
                  th:classappend="${order.pedidoStatus.name() == 'ENTREGADO'} ? 'bg-green-100 text-green-800' : (${order.pedidoStatus.name() == 'CANCELADO'} ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800')">
                              PENDIENTE
                        </span>
          </td>
          <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-700" th:text="${order.guia ?: 'N/A'}">N/A</td>
          <td class="px-4 py-4 whitespace-nowrap text-center text-sm font-medium">
            <a th:href="@{'/admin/order/' + ${order.id}}" class="text-blue-600 hover:text-blue-900">Ver Detalles</a>
          </td>
        </tr>
        </tbody>
        <!-- CAMBIO: Condición para mostrar mensaje si no hay pedidos -->
        <tbody th:if="${#lists.isEmpty(orders)}">
        <tr>
          <td colspan="7" class="px-4 py-6 text-center text-gray-500">No se encontraron pedidos.</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
</body>
</html>
